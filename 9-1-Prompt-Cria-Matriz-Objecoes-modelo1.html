<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atividade 9.1 - Criar Matriz de Obje√ß√µes Personalizada | ANC</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --azul-principal: #1e3a5f;
            --azul-claro: #2d5a87;
            --vermelho-principal: #c41e3a;
            --verde: #27ae60;
            --verde-claro: #2ecc71;
            --amarelo: #f39c12;
            --roxo: #9b59b6;
            --laranja: #e67e22;
            --cinza-fundo: #f8f9fa;
            --cinza-borda: #dee2e6;
            --branco: #ffffff;
            --texto-escuro: #212529;
            --texto-medio: #495057;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, var(--azul-principal) 0%, var(--vermelho-principal) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 950px; margin: 0 auto; }

        .header {
            text-align: center;
            color: var(--branco);
            margin-bottom: 30px;
        }

        .header-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .header p { opacity: 0.9; font-size: 1rem; }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: rgba(255,255,255,0.3);
        }

        .step-indicator {
            text-align: center;
            z-index: 1;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            color: var(--branco);
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .step-indicator.active .step-circle {
            background: var(--verde);
            transform: scale(1.1);
        }

        .step-indicator.completed .step-circle { background: var(--verde); }

        .step-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.75rem;
        }

        .step-indicator.active .step-label {
            color: var(--branco);
            font-weight: 600;
        }

        /* Cards */
        .card {
            background: var(--branco);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: none;
        }

        .card.active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: var(--azul-principal);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--cinza-borda);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title span {
            background: linear-gradient(135deg, var(--vermelho-principal), #e74c3c);
            color: var(--branco);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* Identifica√ß√£o Header */
        .identificacao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .status-salvamento {
            font-size: 0.85rem;
            color: var(--verde);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-salvamento.visivel { opacity: 1; }

        /* Form Groups */
        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--texto-escuro);
            margin-bottom: 8px;
        }

        .form-group .helper {
            font-size: 0.85rem;
            color: var(--texto-medio);
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--cinza-borda);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--vermelho-principal);
        }

        .form-group textarea { min-height: 100px; resize: vertical; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Category Cards */
        .category-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-card {
            border: 2px solid var(--cinza-borda);
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .category-card.selected {
            border-color: var(--verde);
            background: linear-gradient(135deg, #e8f8f0, #d5f5e3);
        }

        .category-card.selected::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--verde);
            color: var(--branco);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .category-icon { font-size: 1.8rem; margin-bottom: 8px; }
        .category-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 5px; }
        .category-desc { font-size: 0.85rem; color: var(--texto-medio); }

        .category-card[data-category="preco"] .category-name { color: var(--vermelho-principal); }
        .category-card[data-category="tempo"] .category-name { color: var(--laranja); }
        .category-card[data-category="autoridade"] .category-name { color: var(--roxo); }
        .category-card[data-category="necessidade"] .category-name { color: #16a085; }
        .category-card[data-category="confianca"] .category-name { color: #3498db; }
        .category-card[data-category="tecnico"] .category-name { color: #7f8c8d; }

        /* Prompt Output */
        .prompt-output {
            background: var(--cinza-fundo);
            border: 2px solid var(--cinza-borda);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .prompt-output pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--texto-escuro);
            max-height: 400px;
            overflow-y: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--vermelho-principal);
            color: var(--branco);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .copy-btn:hover { background: #a71930; transform: scale(1.05); }
        .copy-btn.copied { background: var(--verde); }

        /* Summary Box */
        .summary-box {
            background: linear-gradient(135deg, #ebf5fb, #d4e6f1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }

        .summary-item h4 { font-size: 2rem; color: var(--azul-principal); margin-bottom: 5px; }
        .summary-item span { font-size: 0.85rem; color: var(--texto-medio); }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 50px;
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--vermelho-principal), #e74c3c);
            color: var(--branco);
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--verde), var(--verde-claro));
            color: var(--branco);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .btn-secondary {
            background: var(--branco);
            color: var(--texto-medio);
            border: 2px solid var(--cinza-borda);
        }

        .btn-secondary:hover { background: var(--cinza-fundo); }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--branco);
            border-radius: 16px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--azul-principal), var(--azul-claro));
            color: var(--branco);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; }
        .modal-close { background: none; border: none; color: var(--branco); font-size: 1.5rem; cursor: pointer; }

        .modal-body { padding: 25px; max-height: 50vh; overflow-y: auto; }
        .modal-body textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid var(--cinza-borda);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .modal-footer {
            padding: 20px 25px;
            background: var(--cinza-fundo);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-copiar { background: var(--verde); color: var(--branco); }
        .btn-download { background: var(--azul-principal); color: var(--branco); }

        /* Footer */
        .footer {
            text-align: center;
            color: rgba(255,255,255,0.8);
            padding: 30px 20px;
            font-size: 0.9rem;
        }

        /* Print */
        @media print {
            body { background: white !important; padding: 0; }
            .header, .progress-steps, .btn-group, .footer, .modal-overlay { display: none !important; }
            .card { box-shadow: none; border: 1px solid var(--cinza-borda); display: block !important; }
            .print-info { display: block !important; }
        }

        .print-info { display: none; text-align: center; font-size: 8pt; margin-top: 20px; }

        /* Responsive */
        @media (max-width: 768px) {
            .form-row, .category-cards { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
            .summary-box { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-badge">Atividade Pr√°tica 9.1</div>
            <h1>üõ°Ô∏è Criar Matriz de Obje√ß√µes Personalizada</h1>
            <p>Prepare-se para todas as obje√ß√µes com respostas prontas</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step-indicator active" id="stepInd1">
                <div class="step-circle">1</div>
                <div class="step-label">Contexto</div>
            </div>
            <div class="step-indicator" id="stepInd2">
                <div class="step-circle">2</div>
                <div class="step-label">Categorias</div>
            </div>
            <div class="step-indicator" id="stepInd3">
                <div class="step-circle">3</div>
                <div class="step-label">Detalhes</div>
            </div>
            <div class="step-indicator" id="stepInd4">
                <div class="step-circle">4</div>
                <div class="step-label">Gerar Prompt</div>
            </div>
            <div class="step-indicator" id="stepInd5">
                <div class="step-circle">5</div>
                <div class="step-label">Resultado</div>
            </div>
        </div>

        <!-- STEP 1: Contexto -->
        <div class="card active" id="step1">
            <div class="identificacao-header">
                <div class="card-title"><span>1</span> Contexto da Negocia√ß√£o</div>
                <span class="status-salvamento" id="statusSalvamento">üíæ Salvo automaticamente</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Nome da Negocia√ß√£o *</label>
                    <input type="text" id="negName" placeholder="Ex: Proposta Sistema ERP - Empresa ABC">
                </div>
                <div class="form-group">
                    <label>Valor da Proposta</label>
                    <input type="text" id="dealValue" placeholder="Ex: R$ 150.000">
                </div>
            </div>

            <div class="form-group">
                <label>Sua Empresa/Solu√ß√£o *</label>
                <textarea id="yourCompany" placeholder="Descreva sua empresa e o que voc√™ est√° vendendo..."></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Empresa do Cliente *</label>
                    <input type="text" id="clientCompany" placeholder="Nome e setor da empresa">
                </div>
                <div class="form-group">
                    <label>Decisor Principal *</label>
                    <input type="text" id="decisionMaker" placeholder="Cargo do decisor">
                </div>
            </div>

            <div class="form-group">
                <label>Outros Envolvidos</label>
                <input type="text" id="otherStakeholders" placeholder="Ex: Gerente de TI, CFO, Usu√°rios-chave">
            </div>

            <div class="form-group">
                <label>Situa√ß√£o Atual do Cliente *</label>
                <textarea id="currentSituation" placeholder="Descreva o contexto, problemas atuais, por que est√£o buscando uma solu√ß√£o..."></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="nextStep(2)">Pr√≥ximo: Categorias ‚Üí</button>
            </div>
        </div>

        <!-- STEP 2: Categorias -->
        <div class="card" id="step2">
            <div class="card-title"><span>2</span> Selecione as Categorias de Obje√ß√µes</div>
            <p style="color: var(--texto-medio); margin-bottom: 20px;">Clique nas categorias mais prov√°veis para esta negocia√ß√£o:</p>

            <div class="category-cards">
                <div class="category-card" data-category="preco" onclick="toggleCategory(this)">
                    <div class="category-icon">üí∞</div>
                    <div class="category-name">PRE√áO</div>
                    <div class="category-desc">"Est√° caro", "N√£o temos or√ßamento", "Concorrente √© mais barato"</div>
                </div>
                <div class="category-card" data-category="tempo" onclick="toggleCategory(this)">
                    <div class="category-icon">‚è∞</div>
                    <div class="category-name">TEMPO</div>
                    <div class="category-desc">"N√£o √© prioridade agora", "Vamos deixar para o ano que vem"</div>
                </div>
                <div class="category-card" data-category="autoridade" onclick="toggleCategory(this)">
                    <div class="category-icon">üëî</div>
                    <div class="category-name">AUTORIDADE</div>
                    <div class="category-desc">"Preciso consultar meu chefe", "A diretoria decide"</div>
                </div>
                <div class="category-card" data-category="necessidade" onclick="toggleCategory(this)">
                    <div class="category-icon">üéØ</div>
                    <div class="category-name">NECESSIDADE</div>
                    <div class="category-desc">"N√£o precisamos disso", "O que temos funciona bem"</div>
                </div>
                <div class="category-card" data-category="confianca" onclick="toggleCategory(this)">
                    <div class="category-icon">ü§ù</div>
                    <div class="category-name">CONFIAN√áA</div>
                    <div class="category-desc">"N√£o conhecemos sua empresa", "Preciso ver refer√™ncias"</div>
                </div>
                <div class="category-card" data-category="tecnico" onclick="toggleCategory(this)">
                    <div class="category-icon">‚öôÔ∏è</div>
                    <div class="category-name">T√âCNICO</div>
                    <div class="category-desc">"N√£o integra com nosso sistema", "√â muito complexo"</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(1)">‚Üê Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(3)">Pr√≥ximo: Detalhes ‚Üí</button>
            </div>
        </div>

        <!-- STEP 3: Detalhes -->
        <div class="card" id="step3">
            <div class="card-title"><span>3</span> Detalhes Adicionais</div>

            <div class="form-group">
                <label>Concorrentes no Processo</label>
                <input type="text" id="competitors" placeholder="Ex: Empresa X, Empresa Y">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Pontos Fortes da Sua Proposta</label>
                    <textarea id="strengths" placeholder="O que diferencia sua solu√ß√£o?"></textarea>
                </div>
                <div class="form-group">
                    <label>Vulnerabilidades / Pontos de Aten√ß√£o</label>
                    <textarea id="weaknesses" placeholder="Onde voc√™ pode ser atacado?"></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Hist√≥rico com o Cliente</label>
                    <select id="history">
                        <option value="">Selecione...</option>
                        <option value="primeiro">Primeiro contato</option>
                        <option value="prospeccao">Em prospec√ß√£o h√° pouco tempo</option>
                        <option value="relacionamento">Relacionamento existente</option>
                        <option value="cliente">J√° √© cliente (renova√ß√£o/upsell)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Timeline / Urg√™ncia</label>
                    <select id="timeline">
                        <option value="">Selecione...</option>
                        <option value="urgente">Urgente (decis√£o em dias)</option>
                        <option value="curto">Curto prazo (at√© 30 dias)</option>
                        <option value="medio">M√©dio prazo (1-3 meses)</option>
                        <option value="longo">Longo prazo (3+ meses)</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(2)">‚Üê Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(4)">Pr√≥ximo: Gerar Prompt ‚Üí</button>
            </div>
        </div>

        <!-- STEP 4: Gerar Prompt -->
        <div class="card" id="step4">
            <div class="card-title"><span>4</span> Prompt para IA</div>

            <div class="summary-box">
                <div class="summary-item">
                    <h4 id="summaryCategories">0</h4>
                    <span>Categorias</span>
                </div>
                <div class="summary-item">
                    <h4 id="summaryObjecoes">0</h4>
                    <span>Obje√ß√µes Est.</span>
                </div>
                <div class="summary-item">
                    <h4 id="summaryRespostas">0</h4>
                    <span>Respostas Est.</span>
                </div>
            </div>

            <div class="prompt-output">
                <button class="copy-btn" onclick="copyPrompt()">üìã Copiar Prompt</button>
                <pre id="generatedPrompt"></pre>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(3)">‚Üê Voltar</button>
                <button class="btn btn-success" onclick="nextStep(5)">Pr√≥ximo: Registrar Resultado ‚Üí</button>
            </div>
        </div>

        <!-- STEP 5: Resultado -->
        <div class="card" id="step5">
            <div class="card-title"><span>5</span> Registre o Resultado da IA</div>

            <div class="form-group">
                <label>Cole aqui a Matriz de Obje√ß√µes gerada pela IA</label>
                <div class="helper">Use ChatGPT, Claude ou outra IA com o prompt gerado</div>
                <textarea id="aiResult" style="min-height: 250px;" placeholder="Cole aqui a matriz de obje√ß√µes gerada..."></textarea>
            </div>

            <div class="form-group">
                <label>üìù Suas Adapta√ß√µes e Notas</label>
                <textarea id="adaptations" placeholder="Anote adapta√ß√µes, varia√ß√µes ou observa√ß√µes pessoais..."></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="prevStep(4)">‚Üê Voltar</button>
                <button class="btn btn-success" onclick="imprimirPDF()">üñ®Ô∏è Imprimir / PDF</button>
                <button class="btn btn-success" onclick="abrirModalExportacao()">üì§ Exportar JSON</button>
                <button class="btn btn-secondary" onclick="resetActivity()">üîÑ Nova Atividade</button>
            </div>
        </div>

        <!-- Print Info -->
        <div class="print-info">
            <strong>Negocia√ß√£o para Vendas: M√©todo do Professor</strong><br>
            Prof. Paulo H. Donassolo | Atividade 9.1 - Matriz de Obje√ß√µes<br>
            Gerado em: <span id="print-data"></span>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>Atividade Pr√°tica | M√≥dulo 9 - Gest√£o de Obje√ß√µes e Fechamento</strong></p>
            <p>Negocia√ß√£o para Vendas: M√©todo do Professor | Prof. Paulo H. Donassolo</p>
        </div>
    </div>

    <!-- Modal Exporta√ß√£o -->
    <div class="modal-overlay" id="modalExportacao">
        <div class="modal">
            <div class="modal-header">
                <h3>üì§ Exportar Atividade (JSON)</h3>
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: var(--texto-medio);">Copie o conte√∫do ou clique em "Baixar Arquivo".</p>
                <textarea id="jsonOutput" readonly></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-copiar" onclick="copiarJSON()">üìã Copiar</button>
                <button class="btn btn-download" onclick="baixarJSON()">üíæ Baixar</button>
            </div>
        </div>
    </div>

    <script>
        // Estado
        const STORAGE_KEY = 'anc_atividade_9_1_objecoes';
        let currentStep = 1;
        let selectedCategories = [];
        let dadosExportacao = null;

        // Navega√ß√£o
        function showStep(step) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');

            document.querySelectorAll('.step-indicator').forEach((el, idx) => {
                el.classList.remove('active', 'completed');
                if (idx + 1 < step) el.classList.add('completed');
                if (idx + 1 === step) el.classList.add('active');
            });

            currentStep = step;

            if (step === 4) {
                updateSelectedCategories();
                generatePrompt();
            }
        }

        function nextStep(step) {
            if (step === 2 && !validateStep1()) return;
            if (step === 3 && selectedCategories.length === 0) {
                alert('Por favor, selecione pelo menos uma categoria de obje√ß√£o.');
                return;
            }
            showStep(step);
            autoSave();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevStep(step) {
            showStep(step);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateStep1() {
            const required = ['negName', 'yourCompany', 'clientCompany', 'decisionMaker', 'currentSituation'];
            let valid = true;

            required.forEach(field => {
                const el = document.getElementById(field);
                if (!el.value.trim()) {
                    el.style.borderColor = '#e74c3c';
                    valid = false;
                } else {
                    el.style.borderColor = '#dee2e6';
                }
            });

            if (!valid) alert('Por favor, preencha todos os campos obrigat√≥rios (*)');
            return valid;
        }

        function toggleCategory(el) {
            el.classList.toggle('selected');
            updateSelectedCategories();
            autoSave();
        }

        function updateSelectedCategories() {
            selectedCategories = [];
            document.querySelectorAll('.category-card.selected').forEach(card => {
                selectedCategories.push(card.dataset.category);
            });
        }

        function getCategoryName(cat) {
            const names = {
                'preco': 'PRE√áO',
                'tempo': 'TEMPO',
                'autoridade': 'AUTORIDADE',
                'necessidade': 'NECESSIDADE',
                'confianca': 'CONFIAN√áA',
                'tecnico': 'T√âCNICO'
            };
            return names[cat] || cat;
        }

        function generatePrompt() {
            const negName = document.getElementById('negName').value;
            const yourCompany = document.getElementById('yourCompany').value;
            const dealValue = document.getElementById('dealValue').value || 'N√£o informado';
            const clientCompany = document.getElementById('clientCompany').value;
            const decisionMaker = document.getElementById('decisionMaker').value;
            const otherStakeholders = document.getElementById('otherStakeholders').value || 'N√£o informados';
            const currentSituation = document.getElementById('currentSituation').value;
            const competitors = document.getElementById('competitors').value || 'N√£o identificados';
            const strengths = document.getElementById('strengths').value || 'N√£o informados';
            const weaknesses = document.getElementById('weaknesses').value || 'N√£o informados';
            const history = document.getElementById('history').value || 'N√£o informado';
            const timeline = document.getElementById('timeline').value || 'N√£o definido';

            const categoriesText = selectedCategories.map(c => getCategoryName(c)).join(', ');

            const prompt = `Voc√™ √© um especialista em negocia√ß√£o B2B com 20 anos de experi√™ncia no mercado brasileiro. Preciso que voc√™ crie uma MATRIZ DE OBJE√á√ïES completa e personalizada para a negocia√ß√£o descrita abaixo.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
CONTEXTO DA NEGOCIA√á√ÉO: ${negName}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

MINHA EMPRESA/SOLU√á√ÉO:
${yourCompany}

VALOR DA PROPOSTA:
${dealValue}

EMPRESA DO CLIENTE:
${clientCompany}

DECISOR PRINCIPAL:
${decisionMaker}

OUTROS ENVOLVIDOS:
${otherStakeholders}

SITUA√á√ÉO ATUAL DO CLIENTE:
${currentSituation}

CONCORRENTES NO PROCESSO:
${competitors}

PONTOS FORTES DA PROPOSTA:
${strengths}

VULNERABILIDADES/PONTOS DE ATEN√á√ÉO:
${weaknesses}

HIST√ìRICO COM O CLIENTE:
${history}

TIMELINE/URG√äNCIA:
${timeline}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
CATEGORIAS PRIORIT√ÅRIAS: ${categoriesText}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

INSTRU√á√ïES PARA CRIAR A MATRIZ:

Para cada categoria selecionada (${categoriesText}), crie uma se√ß√£o completa com:

1. **TOP 3-4 OBJE√á√ïES MAIS PROV√ÅVEIS**
   - Fraseado exato como o cliente provavelmente vai dizer
   - Classifica√ß√£o de probabilidade: ALTA, M√âDIA ou BAIXA
   - Se √© obje√ß√£o REAL ou potencialmente FALSA

2. **PARA CADA OBJE√á√ÉO, FORNE√áA:**

   A) **MOTIVA√á√ÉO REAL**
   O que est√° por tr√°s dessa obje√ß√£o

   B) **ESTRAT√âGIA RECOMENDADA**
   Qual das 4 t√©cnicas usar: QUESTIONAR, CONCORDAR E REDIRECIONAR, REFORMULAR ou EVIDENCIAR

   C) **RESPOSTA PR√ÅTICA (SCRIPT)**
   Texto exato que posso usar, adaptado ao contexto

   D) **PERGUNTA DE VALIDA√á√ÉO**
   Como confirmar se a obje√ß√£o foi resolvida

   E) **EVID√äNCIA/PROVA NECESS√ÅRIA**
   Que material de apoio devo ter preparado

3. **T√âCNICAS DE INOCULA√á√ÉO**
   Para as 2 obje√ß√µes mais prov√°veis, sugira como abord√°-las PREVENTIVAMENTE

4. **SINAIS DE ALERTA**
   Linguagem corporal e comportamentos que indicam que essa obje√ß√£o est√° se formando

REQUISITOS:
‚úî Respostas em portugu√™s brasileiro, tom profissional
‚úî Scripts realistas e naturais
‚úî Espec√≠ficos para este cliente e contexto
‚úî Considere o perfil do decisor nas respostas

Por favor, gere a Matriz de Obje√ß√µes completa.`;

            document.getElementById('generatedPrompt').textContent = prompt;

            // Atualizar resumo
            document.getElementById('summaryCategories').textContent = selectedCategories.length;
            document.getElementById('summaryObjecoes').textContent = '~' + (selectedCategories.length * 3);
            document.getElementById('summaryRespostas').textContent = '~' + (selectedCategories.length * 3);
        }

        function copyPrompt() {
            const prompt = document.getElementById('generatedPrompt').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úì Copiado!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copiar Prompt';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Auto-save
        function mostrarStatusSalvamento() {
            const status = document.getElementById('statusSalvamento');
            status.classList.add('visivel');
            setTimeout(() => status.classList.remove('visivel'), 2000);
        }

        function coletarDados() {
            return {
                _meta: { tipo: "atividade_9_1_matriz_objecoes", versao: "1.0", exportadoEm: new Date().toISOString() },
                contexto: {
                    nomeNegociacao: document.getElementById('negName').value,
                    valorProposta: document.getElementById('dealValue').value,
                    suaEmpresa: document.getElementById('yourCompany').value,
                    clienteEmpresa: document.getElementById('clientCompany').value,
                    decisorPrincipal: document.getElementById('decisionMaker').value,
                    outrosEnvolvidos: document.getElementById('otherStakeholders').value,
                    situacaoAtual: document.getElementById('currentSituation').value
                },
                detalhes: {
                    concorrentes: document.getElementById('competitors').value,
                    pontosFortes: document.getElementById('strengths').value,
                    vulnerabilidades: document.getElementById('weaknesses').value,
                    historico: document.getElementById('history').value,
                    timeline: document.getElementById('timeline').value
                },
                categorias: selectedCategories,
                resultadoIA: document.getElementById('aiResult').value,
                adaptacoes: document.getElementById('adaptations').value
            };
        }

        function autoSave() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(coletarDados()));
            mostrarStatusSalvamento();
        }

        function carregarDados() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const d = JSON.parse(saved);
                    if (d.contexto) {
                        if (d.contexto.nomeNegociacao) document.getElementById('negName').value = d.contexto.nomeNegociacao;
                        if (d.contexto.valorProposta) document.getElementById('dealValue').value = d.contexto.valorProposta;
                        if (d.contexto.suaEmpresa) document.getElementById('yourCompany').value = d.contexto.suaEmpresa;
                        if (d.contexto.clienteEmpresa) document.getElementById('clientCompany').value = d.contexto.clienteEmpresa;
                        if (d.contexto.decisorPrincipal) document.getElementById('decisionMaker').value = d.contexto.decisorPrincipal;
                        if (d.contexto.outrosEnvolvidos) document.getElementById('otherStakeholders').value = d.contexto.outrosEnvolvidos;
                        if (d.contexto.situacaoAtual) document.getElementById('currentSituation').value = d.contexto.situacaoAtual;
                    }
                    if (d.detalhes) {
                        if (d.detalhes.concorrentes) document.getElementById('competitors').value = d.detalhes.concorrentes;
                        if (d.detalhes.pontosFortes) document.getElementById('strengths').value = d.detalhes.pontosFortes;
                        if (d.detalhes.vulnerabilidades) document.getElementById('weaknesses').value = d.detalhes.vulnerabilidades;
                        if (d.detalhes.historico) document.getElementById('history').value = d.detalhes.historico;
                        if (d.detalhes.timeline) document.getElementById('timeline').value = d.detalhes.timeline;
                    }
                    if (d.categorias && d.categorias.length > 0) {
                        d.categorias.forEach(cat => {
                            const card = document.querySelector(`.category-card[data-category="${cat}"]`);
                            if (card) card.classList.add('selected');
                        });
                        selectedCategories = d.categorias;
                    }
                    if (d.resultadoIA) document.getElementById('aiResult').value = d.resultadoIA;
                    if (d.adaptacoes) document.getElementById('adaptations').value = d.adaptacoes;
                } catch (e) { console.error('Erro ao carregar:', e); }
            }
        }

        function resetActivity() {
            if (confirm('Tem certeza que deseja come√ßar nova atividade? Todo o progresso ser√° perdido.')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // Modal
        function abrirModalExportacao() {
            dadosExportacao = coletarDados();
            document.getElementById('jsonOutput').value = JSON.stringify(dadosExportacao, null, 2);
            document.getElementById('modalExportacao').classList.add('active');
        }

        function fecharModal() { document.getElementById('modalExportacao').classList.remove('active'); }

        function copiarJSON() {
            const textarea = document.getElementById('jsonOutput');
            textarea.select();
            navigator.clipboard.writeText(textarea.value).then(() => alert('JSON copiado!')).catch(() => { document.execCommand('copy'); alert('JSON copiado!'); });
        }

        function baixarJSON() {
            try {
                const blob = new Blob([JSON.stringify(dadosExportacao, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `matriz_objecoes_${document.getElementById('negName').value.replace(/\s+/g, '_') || 'atividade'}_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                fecharModal();
            } catch (err) { alert('Para baixar, copie o conte√∫do e cole em um arquivo .json'); }
        }

        function imprimirPDF() {
            document.getElementById('print-data').textContent = new Date().toLocaleDateString('pt-BR');
            window.print();
        }

        // Eventos
        document.addEventListener('keydown', e => { if (e.key === 'Escape') fecharModal(); });
        document.getElementById('modalExportacao').addEventListener('click', e => { if (e.target === document.getElementById('modalExportacao')) fecharModal(); });

        document.querySelectorAll('input, textarea, select').forEach(el => {
            el.addEventListener('input', autoSave);
            el.addEventListener('change', autoSave);
        });

        document.addEventListener('DOMContentLoaded', carregarDados);
    </script>
</body>
</html>
